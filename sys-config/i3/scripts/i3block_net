#!/usr/bin/env bash

PRIMARY_IFACE="enp55s0f3u1u4"
FALLBACK_IFACE="wlan0"

iface_up() {
    local iface="$1"
    [[ -d "/sys/class/net/$iface" ]] || return 1
    [[ "$(cat /sys/class/net/$iface/operstate)" == "up" ]] || return 1
    return 0
}

if iface_up "$PRIMARY_IFACE"; then
    IFACE="$PRIMARY_IFACE"
elif iface_up "$FALLBACK_IFACE"; then
    IFACE="$FALLBACK_IFACE"
else
    echo "NET: -"
    exit 0
fi

RX_FILE="/sys/class/net/$IFACE/statistics/rx_bytes"
TX_FILE="/sys/class/net/$IFACE/statistics/tx_bytes"

PREV_RX=$(cat "$RX_FILE")
PREV_TX=$(cat "$TX_FILE")
sleep 1
CURR_RX=$(cat "$RX_FILE")
CURR_TX=$(cat "$TX_FILE")

RX_SPEED=$((CURR_RX - PREV_RX))
TX_SPEED=$((CURR_TX - PREV_TX))

human() {
    local v=$1
    if (( v < 1024 )); then
        echo "${v} B/s"
    elif (( v < 1048576 )); then
        echo "$((v / 1024)) KB/s"
    else
        echo "$((v / 1048576)) MB/s"
    fi
}

echo "↓ $(human "$RX_SPEED") ↑ $(human "$TX_SPEED")"
